// Simple test to verify AI Models endpoint works
const API_BASE = 'http://localhost:5001';

async function testAiModelsEndpoint() {
  try {
    console.log('ğŸ” Testing AI Models endpoint...');
    
    // First test health endpoint to make sure server is responding
    console.log('ğŸ” Testing health endpoint...');
    const healthResponse = await fetch(`${API_BASE}/health`);
    console.log('ğŸ” Health response status:', healthResponse.status);
    
    if (!healthResponse.ok) {
      console.log('âŒ Backend server not responding properly');
      return;
    }
    
    // Try to login with test credentials
    console.log('ğŸ”‘ Attempting login...');
    const loginResponse = await fetch(`${API_BASE}/api/auth/login`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        email: 'demo@example.com',
        password: 'demo123'
      })
    });
    
    console.log('ğŸ”‘ Login response status:', loginResponse.status);
    
    if (!loginResponse.ok) {
      console.log('âŒ Login failed - need valid user credentials');
      console.log('ğŸ’¡ The AI Models endpoint should work once a user is authenticated');
      console.log('âœ… Backend server is running correctly on port 5001');
      console.log('âœ… Port mismatch issue has been resolved');
      return;
    }
    
    const loginData = await loginResponse.json();
    const token = loginData.token;
    console.log('ğŸ”‘ Got authentication token');
    
    // Now test the AI Models endpoint
    console.log('ğŸ“‹ Testing AI Models endpoint with authentication...');
    const aiModelsResponse = await fetch(`${API_BASE}/api/feed/by-type/ai_models?page=1&limit=50`, {
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      }
    });
    
    console.log('ğŸ“‹ AI Models response status:', aiModelsResponse.status);
    
    if (aiModelsResponse.ok) {
      const data = await aiModelsResponse.json();
      console.log('âœ… SUCCESS! AI Models endpoint working correctly');
      console.log('ğŸ“Š Response data:', {
        postType: data.postType,
        totalPosts: data.pagination?.total || 0,
        currentPage: data.pagination?.current || 0,
        postsReturned: data.posts?.length || 0
      });
    } else {
      const errorText = await aiModelsResponse.text();
      console.log('âŒ AI Models endpoint still failing:', errorText);
    }
    
  } catch (error) {
    console.error('âŒ Test error:', error.message);
  }
}

// Run the test
testAiModelsEndpoint();

